# Comprehensive Webserv Test Configuration
# Copy www folder to /tmp/www and run: ./webserv test.conf

server {
    listen 8080;
    server_name localhost;
    
    # Document root
    root /tmp/www/html;
    index index.html index.htm;
    
    # Custom error pages
    error_page 404 /errors/404.html;
    error_page 500 /errors/500.html;
    
    # Default body size limit
    client_max_body_size 10M;
    
    # Root location - static files
    location / {
        allowed_methods GET POST;
        autoindex off;
    }
    
    # Images directory with autoindex
    location /images {
        allowed_methods GET;
        autoindex on;
    }
    
    # CGI scripts - Python, PHP, Shell
    location /cgi-bin {
        root /tmp/www;
        cgi_extension .py .php .sh;
        cgi_pass /usr/bin/python3;
        allowed_methods GET POST;
    }
    
    # File uploads endpoint
    location /upload {
        allowed_methods GET POST;
        upload_store /tmp/www/uploads;
        client_max_body_size 100M;
    }
    
    # View uploaded files
    location /uploads {
        root /tmp/www;
        allowed_methods GET;
        autoindex on;
    }
    
    # Test redirect (301)
    location /old-page {
        return 301 /new-page.html;
    }
    
    # Test temporary redirect (302)
    location /temp-redirect {
        return 302 /;
    }
    
    # Downloads directory
    location /downloads {
        root /tmp/www;
        allowed_methods GET;
        autoindex on;
    }
}

# Second virtual host for testing
server {
    listen 8080;
    server_name test.local;
    
    root /tmp/www/html;
    
    location / {
        allowed_methods GET;
    }
}

# Different port server
server {
    listen 9090;
    root /tmp/www/html;
    
    location / {
        allowed_methods GET POST DELETE;
        autoindex on;
    }
    
    location /cgi-bin {
        root /tmp/www;
        cgi_extension .py .php .sh;
        allowed_methods GET POST;
    }
}
