# Comprehensive Webserv Test Configuration
# Place www folder at project root and run: ./webserv default.conf
#
# IMPORTANT: The router STRIPS the location path from the URI, then appends to root.
# Example: /cgi-bin/hello.py with location /cgi-bin
#          -> strips /cgi-bin -> /hello.py
#          -> root + /hello.py
# So if you want www/cgi-bin/hello.py, set root to www/cgi-bin

server {
    listen 8080;
    server_name hello;

    # Document root for static files (for / location)
    root www/html;
    index index.html index.htm;

    # Custom error pages
    error_page 404 /errors/404.html;
    error_page 500 /errors/500.html;

    # Default body size limit
    client_max_body_size 3M;

    # Root location - static files
    # /index.html -> strips "/" -> /index.html -> www/html/index.html
    location / {
        allowed_methods GET POST;
        autoindex off;
    }

    # Images directory with autoindex
    # /images/pic.jpg -> strips "/images" -> /pic.jpg -> www/html/images/pic.jpg
    location /images {
        root www/html/images;
        allowed_methods GET;
        autoindex on;
    }

    # CGI scripts - Python, PHP, Shell
    # /cgi-bin/hello.py -> strips "/cgi-bin" -> /hello.py -> www/cgi-bin/hello.py
    location /cgi-bin {
        root www/cgi-bin;
        cgi_extension .py .php .sh;
		autoindex on;
        allowed_methods GET POST;
    }

    # File uploads endpoint
    location /upload {
        root www/html;
        allowed_methods GET POST;
        upload_store www/uploads;
        client_max_body_size 10M;
    }

    # View uploaded files
    # /uploads/file.txt -> strips "/uploads" -> /file.txt -> www/uploads/file.txt
    location /uploads {
        root www/uploads;
        allowed_methods GET DELETE;
        autoindex on;
    }

    # Test redirect (301)
    location /old-page {
        return 301 /new-page.html;
    }

    # Test temporary redirect (302)
    location /temp-redirect {
        return 302 /;
    }

    # Downloads directory
    location /downloads {
        root www/downloads;
        allowed_methods GET;
        autoindex on;
    }
}

# Second virtual host for testing
server {
    listen 8070;
    server_name test.local;
    root www/html;

    location / {
        allowed_methods GET;
    }
}

# Different port server
server {
    listen 9090;
    root www/html;

    location / {
        allowed_methods GET POST;
        autoindex on;
    }

    location /cgi-bin {
        root www/cgi-bin;
        cgi_extension .py .php .sh;
        allowed_methods GET POST;
    }
}